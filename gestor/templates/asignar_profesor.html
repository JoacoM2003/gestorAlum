{% extends "base.html" %}

{% block page_title %}Asignar Profesor{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto space-y-6">
    <!-- Back Button -->
    <a href="{% url 'profesores' %}" class="inline-flex items-center text-indigo-600 hover:text-indigo-800 font-medium transition">
        <i class="fas fa-arrow-left mr-2"></i>
        Volver a Profesores
    </a>

    <!-- Form Card -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
        <!-- Header -->
        <div class="gradient-bg p-6">
            <div class="flex items-center">
                <div class="w-14 h-14 bg-white/20 backdrop-blur rounded-lg flex items-center justify-center mr-4">
                    <i class="fas fa-user-check text-3xl text-white"></i>
                </div>
                <div>
                    <h1 class="text-2xl font-bold text-white">Asignar Profesor a Comisión</h1>
                    <p class="text-indigo-100">Vincula un profesor con una materia y comisión específica</p>
                </div>
            </div>
        </div>

        <!-- Form -->
        <form method="POST" class="p-6 space-y-6">
            {% csrf_token %}
            
            <!-- Profesor Selection -->
            <div>
                <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
                    <i class="fas fa-chalkboard-teacher mr-2 text-indigo-600"></i>
                    Seleccionar Profesor
                </h3>
                
                <div>
                    <label for="profesor" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-user mr-1 text-gray-400"></i>
                        Profesor
                        <span class="text-red-500">*</span>
                    </label>
                    <select 
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition" 
                        id="profesor" 
                        name="profesor"
                        required>
                        <option value="">-- Seleccione un profesor --</option>
                        {% for profesor in profesores %}
                        <option value="{{ profesor.id }}">
                            {{ profesor.user.get_full_name }} - Legajo: {{ profesor.legajo }}
                        </option>
                        {% endfor %}
                    </select>
                    <p class="mt-1 text-xs text-gray-500">
                        <i class="fas fa-info-circle mr-1"></i>
                        Elige el profesor que deseas asignar
                    </p>
                </div>
            </div>

            <div class="border-t border-gray-200 pt-6">
                <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
                    <i class="fas fa-book mr-2 text-indigo-600"></i>
                    Seleccionar Materia y Comisión
                </h3>
                
                <!-- Materia Selection -->
                <div class="mb-6">
                    <label for="materia" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-book-open mr-1 text-gray-400"></i>
                        Materia
                        <span class="text-red-500">*</span>
                    </label>
                    <select 
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition" 
                        id="materia" 
                        name="materia"
                        onchange="filterComisiones()"
                        required>
                        <option value="">-- Seleccione una materia --</option>
                        {% for materia in materias %}
                        <option value="{{ materia.id }}">
                            {{ materia.codigo }} - {{ materia.nombre }} ({{ materia.año }}° Año)
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Comision Selection -->
                <div>
                    <label for="comision" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-users mr-1 text-gray-400"></i>
                        Comisión
                        <span class="text-red-500">*</span>
                    </label>
                    <select 
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition" 
                        id="comision" 
                        name="comision"
                        required
                        disabled>
                        <option value="">-- Primero seleccione una materia --</option>
                    </select>
                    <p class="mt-1 text-xs text-gray-500">
                        <i class="fas fa-info-circle mr-1"></i>
                        Las comisiones se filtrarán según la materia seleccionada
                    </p>
                </div>
            </div>

            <div class="border-t border-gray-200 pt-6">
                <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
                    <i class="fas fa-user-tag mr-2 text-indigo-600"></i>
                    Rol del Profesor
                </h3>
                
                <div>
                    <label for="rol_profesor" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-star mr-1 text-gray-400"></i>
                        Rol
                        <span class="text-red-500">*</span>
                    </label>
                    <select 
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition" 
                        id="rol_profesor" 
                        name="rol_profesor"
                        required>
                        <option value="">-- Seleccione un rol --</option>
                        {% for rol in roles %}
                        <option value="{{rol.0}}">{{ rol.1 }}</option>
                        {% endfor %}
                    </select>
                    <p class="mt-1 text-xs text-gray-500">
                        <i class="fas fa-info-circle mr-1"></i>
                        Define si será Titular o Ayudante en esta comisión
                    </p>
                </div>
            </div>

            <!-- Info Box -->
            <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded">
                <div class="flex">
                    <i class="fas fa-info-circle text-blue-500 mt-0.5 mr-3"></i>
                    <div>
                        <p class="text-sm text-blue-700 font-medium mb-1">Información sobre Asignaciones</p>
                        <ul class="text-sm text-blue-600 space-y-1">
                            <li>• Un profesor puede ser Titular o Ayudante en múltiples comisiones</li>
                            <li>• Se recomienda tener al menos un Titular por comisión</li>
                            <li>• Los profesores asignados podrán ver y gestionar a los alumnos de esas comisiones</li>
                            <li>• Puedes modificar o eliminar asignaciones desde el perfil del profesor</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Buttons -->
            <div class="flex gap-3 pt-4">
                <button 
                    type="submit" 
                    class="flex-1 px-6 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white rounded-lg font-semibold transition transform hover:scale-[1.02] shadow-lg">
                    <i class="fas fa-check mr-2"></i>
                    Asignar Profesor
                </button>
                <a href="{% url 'profesores' %}" 
                   class="px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg font-semibold transition">
                    <i class="fas fa-times mr-2"></i>
                    Cancelar
                </a>
            </div>
        </form>
    </div>

    <!-- Quick Reference Card -->
    <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl p-6 border border-purple-100">
        <div class="flex items-start gap-4">
            <div class="w-12 h-12 bg-purple-500 rounded-lg flex items-center justify-center flex-shrink-0">
                <i class="fas fa-graduation-cap text-white text-xl"></i>
            </div>
            <div>
                <h4 class="font-bold text-gray-900 mb-2">Roles de Profesor</h4>
                <div class="grid md:grid-cols-2 gap-4 text-sm text-gray-700">
                    <div>
                        <p class="font-semibold mb-1"><i class="fas fa-star text-indigo-600 mr-1"></i> Titular</p>
                        <p>Profesor principal a cargo de la comisión. Responsable de la coordinación general y decisiones académicas.</p>
                    </div>
                    <div>
                        <p class="font-semibold mb-1"><i class="fas fa-hands-helping text-purple-600 mr-1"></i> Ayudante</p>
                        <p>Profesor de apoyo que asiste al titular. Colabora en clases y gestión de alumnos.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Almacenar todas las comisiones organizadas por materia
const comisionesPorMateria = {
    {% for comision in comisiones %}
    {% if comision.materia.id not in comisionesPorMateria %}
    {{ comision.materia.id }}: [],
    {% endif %}
    {% endfor %}
};

// Llenar el objeto con las comisiones
{% for comision in comisiones %}
if (!comisionesPorMateria[{{ comision.materia.id }}]) {
    comisionesPorMateria[{{ comision.materia.id }}] = [];
}
comisionesPorMateria[{{ comision.materia.id }}].push({
    id: {{ comision.id }},
    nombre: "{{ comision.comision.nombre }}",
    cupo: {{ comision.cupo_maximo }},
    inscriptos: {{ comision.cantidad_inscriptos }}
});
{% endfor %}

function filterComisiones() {
    const materiaSelect = document.getElementById('materia');
    const comisionSelect = document.getElementById('comision');
    const materiaId = materiaSelect.value;
    
    // Limpiar comisiones
    comisionSelect.innerHTML = '<option value="">-- Seleccione una comisión --</option>';
    
    if (materiaId && comisionesPorMateria[materiaId]) {
        comisionSelect.disabled = false;
        
        comisionesPorMateria[materiaId].forEach(comision => {
            const option = document.createElement('option');
            option.value = comision.id;
            option.textContent = `${comision.nombre} (${comision.inscriptos}/${comision.cupo} alumnos)`;
            comisionSelect.appendChild(option);
        });
    } else {
        comisionSelect.disabled = true;
        comisionSelect.innerHTML = '<option value="">-- Primero seleccione una materia --</option>';
    }
}
</script>
{% endblock %}